% Second controller for smart.city.kempten LEGO(R) Model
% INNER CITY BACK (BASE PLATE 1)
\documentclass[border=10pt]{standalone}
\usepackage[european,siunitx]{circuitikz}
\begin{document}

\begin{circuitikz}
 \ctikzset{multipoles/thickness=2}
 \ctikzset{multipoles/external pins thickness=2}

\ctikzset{multipoles/dipchip/width=3}
 \draw (6.5,5) node[dipchip,
 num pins=8,
 hide numbers,
 no topmark,
 external pins width=0.0,
 external pad fraction=4](display){Traffic Count};
 \draw [color=red] (display.pin 1) -- ++(-1,0) node[vcc, font=\small]{USB Power};
 \draw [color=black] (display.pin 2) -- ++(-1,0) node[ground, font=\small]{};
 \node [left, font=\tiny] at (display.pin 8) {SDA};
 \node [left, font=\tiny] at (display.pin 7) {SCL};

\draw (13.25,1) node[dipchip,
 num pins=40,
 hide numbers,
 no topmark,
 external pins width=0.0,
 external pad fraction=4 ](P){PICO W};

\draw (P.pin 38) -- ++(1.5,0) node[ground, font=\small]{};
\draw [color=red] (P.pin 40) -- ++(1.5,0) node[vcc, font=\small]{USB Power};
\draw [color=red] (P.pin 36) -- ++(0.5,0) node[vcc, font=\small]{3V3};

\node [right, font=\tiny] at (P.pin 1) {I2C0 SDA};
\node [right, font=\tiny] at (P.pin 2) {I2C0 SCL};
\node [right, font=\tiny] at (P.pin 4) {I2C1 SDA};
\node [right, font=\tiny] at (P.pin 5) {I2C1 SCL};
\node [right, font=\tiny] at (P.pin 6) {GP4};
\node [right, font=\tiny] at (P.pin 7) {GP5};
\node [right, font=\tiny] at (P.pin 9) {GP6};
\node [right, font=\tiny] at (P.pin 10) {GP7};
\node [right, font=\tiny] at (P.pin 12) {GP9};
\node [right, font=\tiny] at (P.pin 13) {GND};
\node [right, font=\tiny] at (P.pin 14) {GP10};
\node [right, font=\tiny] at (P.pin 15) {GP11};
\node [right, font=\tiny] at (P.pin 16) {GP12};
\node [right, font=\tiny] at (P.pin 17) {GP13};
\node [right, font=\tiny] at (P.pin 18) {GND};
\node [right, font=\tiny] at (P.pin 19) {GP14};

\node [left, font=\tiny] at (P.pin 22) {GP17};
\node [left, font=\tiny] at (P.pin 23) {GND};
\node [left, font=\tiny] at (P.pin 24) {GP18};
\node [left, font=\tiny] at (P.pin 25) {GP19};
\node [left, font=\tiny] at (P.pin 26) {GP20};
\node [left, font=\tiny] at (P.pin 27) {GP21};
\node [left, font=\tiny] at (P.pin 28) {GND};
\node [left, font=\tiny] at (P.pin 29) {GP22};

\node [left, font=\tiny] at (P.pin 31) {GP26};
\node [left, font=\tiny] at (P.pin 32) {GP27};

\node [left, font=\tiny] at (P.pin 36) {3V3};
\node [left, font=\tiny] at (P.pin 38) {GND};
\node [left, font=\tiny] at (P.pin 39) {VSYS};
\node [left, font=\tiny] at (P.pin 40) {VBUS};

\foreach \x in {0,...,2} {
 \draw (11.5+\x*1.5,-6) to[empty led] (12+\x*1.5,-6);
 \draw [color=red] (11.5+\x*1.5,-6) -- ++(-0.25,0) |- (11.5+\x*1.5,-7);
 \draw (12+\x*1.5,-6) -- ++(0.25,0) |- (12.25+\x*1.5,-7.25);
 }

\draw [color=red] (9,-7) node[vcc, font=\small]{USB Power} to[R=1.5\si{\kilo\ohm}, font=\small] ++(3,0) -- ++(3,0);
\draw (12.25, -7.25) -- ++(3.0,0) node[ground, font=\small]{};


\foreach \column in {1,...,4} {
  \foreach \light in {1,...,3} {

    \ifnum\light=1
      \ifodd\column
        \draw [color=red] (P.pin 12) to[R=470\si{\ohm}, font=\tiny] ++(-1.5,0) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=red] (P.pin 19) to[R=470\si{\ohm}, font=\tiny] ++(-1.5,0) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
      \draw [color=red] (-3.25+\column*2.5-\light*0.25,-5-\light*.25) -- (-3.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (-3.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifnum\light=2
      \ifodd\column
        \draw [color=yellow] (P.pin 14) to[R=470\si{\ohm}, font=\tiny] ++(-1.5,0) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=yellow] (P.pin 17) to[R=470\si{\ohm}, font=\tiny] ++(-4.,0) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
       \draw [color=yellow] (-3.25+\column*2.5-\light*0.25,-5-\light*.25) -- (-3.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (-3.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifnum\light=3
      \ifodd\column
        \draw [color=green] (P.pin 15) to[R=680\si{\ohm}, font=\tiny] ++(-4.,0) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=green] (P.pin 16) to[R=680\si{\ohm}, font=\tiny] ++(-1.5,0) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
       \draw [color=green] (-3.25+\column*2.5-\light*0.25,-5-\light*.25) -- (-3.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (-3.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifodd\column
      \newcommand\ground{13}
    \else
      \newcommand\ground{18}
    \fi
    \draw (-3.25+\column*2.5,-7-\light*1.5) to[empty led] (-2.75+\column*2.5,-7-\light*1.5) -- ++(0.5,0) |- (P.pin \inteval\ground);
    }
}

 \foreach \column in {1,...,3} {
  \foreach \light in {1,...,3} {

    \ifnum\light=1
      \ifodd\column
        \draw [color=red] (P.pin 29) to[R=470\si{\ohm}, font=\tiny] ++(1.5,0) -| (17.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=red] (P.pin 22) to[R=470\si{\ohm}, font=\tiny] ++(1.5,0) -| (17.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
      \draw [color=red] (17.25+\column*2.5-\light*0.25,-5-\light*.25) -- (17.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (17.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifnum\light=2
      \ifodd\column
        \draw [color=yellow] (P.pin 27) to[R=470\si{\ohm}, font=\tiny] ++(1.5,0) -| (17.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=yellow] (P.pin 24) to[R=470\si{\ohm}, font=\tiny] ++(4.5,0) -| (17.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
       \draw [color=yellow] (17.25+\column*2.5-\light*0.25,-5-\light*.25) -- (17.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (17.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifnum\light=3
      \ifodd\column
        \draw [color=green] (P.pin 26) to[R=680\si{\ohm}, font=\tiny] ++(4.5,0) -| (17.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=green] (P.pin 25) to[R=680\si{\ohm}, font=\tiny] ++(1.5,0) -| (17.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
       \draw [color=green] (17.25+\column*2.5-\light*0.25,-5-\light*.25) -- (17.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (17.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifodd\column
      \newcommand\ground{28}
    \else
      \newcommand\ground{23}
    \fi
    \draw (17.25+\column*2.5,-7-\light*1.5) to[empty led] (17.75+\column*2.5,-7-\light*1.5) -- ++(0.5,0) |- (P.pin \inteval\ground);
    }
}


\draw [color=orange] (display.pin 8) -- ++(1.2,0) |- (P.pin 1) -- (P.pin 1){};
\draw [color=blue] (display.pin 7) -- ++(1.4,0) |- (P.pin 2) -- (P.pin 2){};

\newcommand\hallsensor[3]{
 \ctikzset{multipoles/dipchip/width=0.8}
 \draw (#1,#2) node[dipchip,
 num pins=4,
 hide numbers,
 no topmark,
 external pins width=0.0,
 external pad fraction=4,
 rotate=90](#3){$#3$};
 \node [below, font=\tiny] at (#3.pin 4) {D};
 \node [below, font=\tiny] at (#3.pin 3) {A};
 %\node [above, font=\tiny] at (#3.pin 2) {GND};
 %\node [above, font=\tiny] at (#3.pin 1) {VCC};
}


\foreach \x in {1,...,2} {
 \hallsensor{30-\x*1.5}{0}{TC_\x}
 }

\draw [color=blue] (TC_1.pin 4) |-  (P.pin 32){};
\draw [color=blue] (TC_2.pin 4) |- (P.pin 31){};

\foreach \x in {3,...,6} {
 \hallsensor{2-\x*1.5}{0}{TC_\x}
 }

\draw [color=blue] (TC_3.pin 4) |-  (P.pin 6){};
\draw [color=blue] (TC_4.pin 4) |- (P.pin 7){};

\draw [color=blue] (TC_5.pin 4) |-  (P.pin 9){};
\draw [color=blue] (TC_6.pin 4) |- (P.pin 10){};


\end{circuitikz}

\end{document}
