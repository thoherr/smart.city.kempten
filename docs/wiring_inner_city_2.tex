% Second controller for smart.city.kempten LEGO(R) Model
% INNER CITY BACK (BASE PLATE 1)
\documentclass[border=10pt]{standalone}
\usepackage[european,siunitx]{circuitikz}
\begin{document}

\begin{circuitikz}
 \ctikzset{multipoles/thickness=2}
 \ctikzset{multipoles/external pins thickness=2}

\ctikzset{multipoles/dipchip/width=3}
 \draw (5,6.25) node[dipchip,
 num pins=4,
 hide numbers,
 no topmark,
 external pins width=0.0,
 external pad fraction=4](display){Display};
 \draw [color=red] (display.pin 1) -- ++(-1,0) node[vcc, font=\small]{USB Power};
 \draw [color=black] (display.pin 2) -- ++(-1,0) node[ground, font=\small]{};
 \node [left, font=\tiny] at (display.pin 4) {SDA};
 \node [left, font=\tiny] at (display.pin 3) {SCL};

\draw (12,1) node[dipchip,
 num pins=40,
 hide numbers,
 no topmark,
 external pins width=0.0,
 external pad fraction=4 ](P){PICO W};

\draw (P.pin 38) -- ++(1.5,0) node[ground, font=\small]{};
\draw [color=red] (P.pin 40) -- ++(1.5,0) node[vcc, font=\small]{USB Power};
\draw [color=red] (P.pin 36) -- ++(0.5,0) node[vcc, font=\small]{3V3};

\node [right, font=\tiny] at (P.pin 1) {I2C0 SDA};
\node [right, font=\tiny] at (P.pin 2) {I2C0 SCL};
\node [right, font=\tiny] at (P.pin 4) {I2C1 SDA};
\node [right, font=\tiny] at (P.pin 5) {I2C1 SCL};
\node [right, font=\tiny] at (P.pin 12) {GP9};
\node [right, font=\tiny] at (P.pin 13) {GND};
\node [right, font=\tiny] at (P.pin 14) {GP10};
\node [right, font=\tiny] at (P.pin 15) {GP11};
\node [right, font=\tiny] at (P.pin 16) {GP12};
\node [right, font=\tiny] at (P.pin 17) {GP13};
\node [right, font=\tiny] at (P.pin 18) {GND};
\node [right, font=\tiny] at (P.pin 19) {GP14};

\node [left, font=\tiny] at (P.pin 31) {GP26};
\node [left, font=\tiny] at (P.pin 32) {GP27};

\node [left, font=\tiny] at (P.pin 36) {3V3};
\node [left, font=\tiny] at (P.pin 38) {GND};
\node [left, font=\tiny] at (P.pin 39) {VSYS};
\node [left, font=\tiny] at (P.pin 40) {VBUS};

\foreach \column in {1,...,4} {
  \foreach \light in {1,...,3} {

    \ifnum\light=1
      \ifodd\column
        \draw [color=red] (P.pin 12) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=red] (P.pin 19) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
      \draw [color=red] (-3.25+\column*2.5-\light*0.25,-5-\light*.25) -- (-3.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (-3.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifnum\light=2
      \ifodd\column
        \draw [color=yellow] (P.pin 14) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=yellow] (P.pin 17) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
       \draw [color=yellow] (-3.25+\column*2.5-\light*0.25,-5-\light*.25) -- (-3.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (-3.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifnum\light=3
      \ifodd\column
        \draw [color=green] (P.pin 15) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \else
        \draw [color=green] (P.pin 16) -| (-3.25+\column*2.5-\light*0.25,-5-\light*.25);
      \fi
       \draw [color=green] (-3.25+\column*2.5-\light*0.25,-5-\light*.25) -- (-3.25+\column*2.5-\light*0.25,-7-\light*1.5) -- (-3.25+\column*2.5,-7-\light*1.5);
    \fi

    \ifodd\column
      \newcommand\ground{13}
    \else
      \newcommand\ground{18}
    \fi
    \draw (-3.25+\column*2.5,-7-\light*1.5) to[empty led] (-2.75+\column*2.5,-7-\light*1.5) -- ++(0.5,0) |- (P.pin \inteval\ground);
    }
}

\draw [color=orange] (display.pin 4) -- ++(1.6,0) |- (P.pin 1) -- (P.pin 1){};
\draw [color=blue] (display.pin 3) -- ++(1.4,0) |- (P.pin 2) -- (P.pin 2){};

\newcommand\hallsensor[3]{
 \ctikzset{multipoles/dipchip/width=0.8}
 \draw (#1,#2) node[dipchip,
 num pins=4,
 hide numbers,
 no topmark,
 external pins width=0.0,
 external pad fraction=4,
 rotate=90](#3){$#3$};
 \node [below, font=\tiny] at (#3.pin 4) {D};
 \node [below, font=\tiny] at (#3.pin 3) {A};
 %\node [above, font=\tiny] at (#3.pin 2) {GND};
 %\node [above, font=\tiny] at (#3.pin 1) {VCC};
}


\foreach \x in {1,...,2} {
 \hallsensor{20-\x*1.5}{0}{TC_\x}
 }


\draw [color=blue] (TC_1.pin 4) |-  (P.pin 32){};
\draw [color=blue] (TC_2.pin 4) |- (P.pin 31){};

\end{circuitikz}

\end{document}
